<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:context="http://www.springframework.org/schema/context"

       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">

    <!-- enable aspect j -->
    <aop:aspectj-autoproxy>
        <aop:include name="checkNotNullAspect"/>
        <aop:include name="logSetterValueAspect" />
    </aop:aspectj-autoproxy>

    <!-- substitutde JVM args with ${varname} -->
    <context:property-placeholder />


    <!--
    Aspect to check a setter is not setting a null value
    -->
    <bean id="checkNotNullAspect" class="au.org.emii.portal.aspect.CheckNotNullAspect" />

    <!--
    Aspect to log the value set by a setter
    -->
    <bean id="logSetterValueAspect" class="au.org.emii.portal.aspect.LogSetterValueAspect" />

    <!--
    Main settings from config file
    -->
    <bean id="settings" class="au.org.emii.portal.settings.SettingsImpl">
        <property name="configPath" value="${WEBPORTAL_CONFIG_DIR}" />
    </bean>


    <!--
    Additional key/value pair values from config file
    -->
    <bean id="settingsSupplementary" class="au.org.emii.portal.settings.SettingsSupplementaryImpl" />
    <bean id="remoteLogger" class="org.ala.logger.client.RemoteLogger">
        <property name="settingsSupplementary" ref="settingsSupplementary" />
    </bean>

    <!--
    Class for resolving hostname
    -->
    <bean id="resolveHostName" class="au.org.emii.portal.util.ResolveHostNameImpl" />

    <!--
    Language strings and icon names
    -->
    <bean id="languagePack" class="au.org.emii.portal.lang.LanguagePackImpl" />

    <!--
    Support for reading and changing the portal name
    -->
    <bean id="portalNaming" class="au.org.emii.portal.util.PortalNamingImpl">
        <property name="settings" ref="settings" />
    </bean>

    <!--
    Bean for reloading log4j configuration, eg after a name change
    -->
    <bean id="log4jLoader" class="au.org.emii.portal.web.Log4jLoader">
        <property name="portalNaming" ref="portalNaming" />
        <property name="resolveHostname" ref="resolveHostName" />
        <property name="settings" ref="settings" />
    </bean>

    <!--
    Bean to update the portal name in the .properties file and reload the log4j
    configuration
    -->
    <bean id="portalNamingUpdater" class="au.org.emii.portal.util.PortalNamingUpdaterImpl">
        <property name="languagePack" ref="languagePack" />
        <property name="log4jLoader" ref="log4jLoader" />
        <property name="portalNaming" ref="portalNaming" />
        <property name="propertiesWriter" ref="propertiesWriter" />
    </bean>

    <!--
    List of iso countries - used for registration system.
    -->
    <bean id="isoCountries" class="au.org.emii.portal.util.IsoCountriesImpl">
        <property name="settings" value="#{settings}" />
    </bean>

    <bean id="uriResolver" class="au.org.emii.portal.util.UriResolverImpl" />

    <bean id="configurationLoaderStage1" class="au.org.emii.portal.config.ConfigurationLoaderStage1Impl">
        <property name="portalDocumentFactory" ref="portalDocumentFactory" />
        <property name="settings" ref="settings" />
        <property name="stage2" ref="configurationLoaderStage2" />
        <property name="portalSessionUtilities" ref="portalSessionUtilities" />
    </bean>

    <bean id="configurationLoaderStage2" class="au.org.emii.portal.config.ConfigurationLoaderStage2Impl">
        <property name="uriResolver" ref="uriResolver" />
        <property name="remoteMap" ref="remoteMap" />
        <property name="httpAuthenticateProxy" ref="httpAuthenticateProxy" />
        <property name="settings" ref="settings" />
        <property name="settingsSupplementary" ref="settingsSupplementary" />
        <property name="portalSessionUtilities" ref="portalSessionUtilities" />
    </bean>

    <bean id="layerUtilities" class="au.org.emii.portal.util.LayerUtilitiesImpl">
        <property name="settings" ref="settings" />
        <property name="settingsSupplementary" ref="settingsSupplementary" />
        <property name="resolveHostname" ref="resolveHostName" />
    </bean>



    <bean id="portalDocumentFactory" class="au.org.emii.portal.factory.PortalDocumentFactoryFileImpl">
        <property name="settings" ref="settings" />
    </bean>

    <!--
    Example of how to read (a string) from settingsSupplementary
    <property name="animationHeight" value="#{settingsSupplementary.values['animation_height']}" />
    -->

    <bean id="remoteMap" class="au.org.emii.portal.wms.RemoteMapImpl" scope="prototype">
        <property name="uriResolver" ref="uriResolver" />
        <property name="languagePack" ref="languagePack" />
        <property name="layerUtilities" ref="layerUtilities" />
        <property name="httpConnection" ref="httpConnection" />
        <property name="geoJSONUtilities" ref="geoJSONUtilities" />
    </bean>

    <bean id="geoJSONUtilities" class="au.org.emii.portal.util.GeoJSONUtilitiesImpl">
        <property name="httpConnection" ref="httpConnection" />
    </bean>

    <bean id="openLayersJavascript" class="au.org.emii.portal.javascript.OpenLayersJavascriptImpl">
        <property name="settingsSupplementary" ref="settingsSupplementary" />
        <property name="layerUtilities" ref="layerUtilities" />
    </bean>

    <bean id="remoteRequestServlet" class="au.org.emii.portal.servlet.RemoteRequestServlet">
        <property name="settings" ref="settings" />
        <property name="httpConnection" ref="httpConnection" />
    </bean>

    <bean id="userMachine" class="au.org.emii.portal.servlet.UserMachine" />

    <bean id="httpConnection" class="au.org.emii.portal.net.HttpConnectionImpl">
        <property name="settings" ref="settings" />
    </bean>

    <bean id="httpAuthenticateProxy" class="au.org.emii.portal.net.HttpAuthenticateProxy">
        <property name="settings" ref="settings" />
    </bean>

    <bean id="propertiesWriter" class="au.org.emii.portal.util.PropertiesWriterImpl">
        <property name="languagePack" ref="languagePack" />
    </bean>

    <bean id="wmsSupport" class="au.org.emii.portal.wms.WMSSupport" abstract="true">
        <property name="layerUtilities" ref="layerUtilities" />
        <property name="languagePack" ref="languagePack" />
        <property name="uriResolver" ref="uriResolver" />
        <property name="httpConnection" ref="httpConnection" />
    </bean>


    <bean id="wMSSupport_1_3_0" class="au.org.emii.portal.wms.WMSSupport_1_3_0" parent="wmsSupport" scope="prototype" />
    <bean id="ncWMSSupport" class="au.org.emii.portal.wms.NcWMSSupport" parent="wmsSupport" scope="prototype" />
    <bean id="threddsSupport" class="au.org.emii.portal.wms.ThreddsSupport" parent="wmsSupport" scope="prototype" />

    <bean id="motd" class="au.org.emii.portal.motd.MOTDImpl">
        <property name="propertiesWriter" ref="propertiesWriter" />
        <property name="settings" ref="settings" />
    </bean>

    <bean id="activeLayerRenderer" class="au.org.emii.portal.databinding.ActiveLayerRenderer" >
        <property name="languagePack" ref="languagePack" />
        <property name="layerUtilities" ref="layerUtilities" />
        <property name="visibilityToggleEventListener" ref="visibilityToggleEventListener" />
    </bean>

    <bean id="visibilityToggleEventListener" class="au.org.emii.portal.event.VisibilityToggleEventListener">
        <property name="openLayersJavascript" ref="openLayersJavascript" />
    </bean>

    <bean id="listUtilities" class="au.org.emii.portal.util.ListUtilities" />

    <bean id="portalSessionUtilities" class="au.org.emii.portal.util.PortalSessionUtilities">
        <property name="languagePack" ref="languagePack" />
        <property name="listUtilities" ref="listUtilities" />
        <property name="settingsSupplementary" ref="settingsSupplementary" />
        <property name="settings" ref="settings" />
    </bean>

    <bean id="portalSessionCloner" class="au.org.emii.portal.util.PortalSessionCloner">
        <property name="portalSessionUtilities" ref="portalSessionUtilities" />
    </bean>

</beans>